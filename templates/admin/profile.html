{% extends "admin/base.html" %} {% block title %}Profile Management - Admin
Panel{% endblock %}

<script>
  let cropper;
  let originalFile;

  function previewImage(input) {
    if (input.files && input.files[0]) {
      originalFile = input.files[0];
      const reader = new FileReader();

      reader.onload = function (e) {
        document.getElementById("cropperImage").src = e.target.result;

        // Show the modal
        const modal = new bootstrap.Modal(
          document.getElementById("cropperModal")
        );
        modal.show();

        // Initialize cropper after modal is shown
        setTimeout(() => {
          const image = document.getElementById("cropperImage");
          cropper = new Cropper(image, {
            aspectRatio: 1,
            viewMode: 1,
            dragMode: "move",
            autoCropArea: 1,
            restore: false,
            guides: true,
            center: true,
            highlight: false,
            cropBoxMovable: true,
            cropBoxResizable: true,
            toggleDragModeOnDblclick: false,
          });
        }, 500);
      };

      reader.readAsDataURL(input.files[0]);
    }
  }

  function cropImage() {
    if (cropper) {
      cropper
        .getCroppedCanvas({
          width: 400,
          height: 400,
          imageSmoothingEnabled: true,
          imageSmoothingQuality: "high",
        })
        .toBlob(function (blob) {
          // Create a new file input with the cropped image
          const croppedFile = new File([blob], originalFile.name, {
            type: originalFile.type,
            lastModified: Date.now(),
          });

          // Create a new FileList-like object
          const dataTransfer = new DataTransfer();
          dataTransfer.items.add(croppedFile);

          // Update the file input
          document.getElementById("photo").files = dataTransfer.files;

          // Close the modal
          const modal = bootstrap.Modal.getInstance(
            document.getElementById("cropperModal")
          );
          modal.hide();

          // Show preview of cropped image
          const reader = new FileReader();
          reader.onload = function (e) {
            const previewContainer =
              document.querySelector(".mb-3:has(#photo)");
            let preview = previewContainer.querySelector(".cropped-preview");
            if (!preview) {
              preview = document.createElement("div");
              preview.className = "cropped-preview mt-2";
              preview.innerHTML =
                '<label class="form-label">Cropped Preview:</label><br><img src="" alt="Cropped Preview" class="img-thumbnail" style="max-width: 150px">';
              previewContainer.appendChild(preview);
            }
            preview.querySelector("img").src = e.target.result;
          };
          reader.readAsDataURL(croppedFile);
        });
    }
  }

  // Clean up cropper when modal is hidden
  document
    .getElementById("cropperModal")
    .addEventListener("hidden.bs.modal", function () {
      if (cropper) {
        cropper.destroy();
        cropper = null;
      }
    });
</script>
{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="mb-2"><i class="fas fa-user me-2"></i>Profile Management</h2>
      <p class="text-muted mb-0">
        Edit your personal information and profile details
      </p>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8 mx-auto">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-edit me-2"></i>Edit Profile</h5>
        </div>
        <div class="card-body">
          <form method="POST" enctype="multipart/form-data">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="name" class="form-label">
                    <i class="fas fa-user me-2"></i>Full Name *
                  </label>
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    name="name"
                    value="{{ profile.name if profile else '' }}"
                    required
                  />
                </div>

                <div class="mb-3">
                  <label for="title" class="form-label">
                    <i class="fas fa-briefcase me-2"></i>Professional Title
                  </label>
                  <input
                    type="text"
                    class="form-control"
                    id="title"
                    name="title"
                    value="{{ profile.title if profile else '' }}"
                    placeholder="e.g., Full Stack Developer"
                  />
                </div>

                <div class="mb-3">
                  <label for="email" class="form-label">
                    <i class="fas fa-envelope me-2"></i>Email Address
                  </label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    value="{{ profile.email if profile else '' }}"
                    placeholder="your.email@example.com"
                  />
                </div>

                <div class="mb-3">
                  <label for="phone" class="form-label">
                    <i class="fas fa-phone me-2"></i>Phone Number
                  </label>
                  <input
                    type="tel"
                    class="form-control"
                    id="phone"
                    name="phone"
                    value="{{ profile.phone if profile else '' }}"
                    placeholder="+1 234 567 8900"
                  />
                </div>

                <div class="mb-3">
                  <label for="location" class="form-label">
                    <i class="fas fa-map-marker-alt me-2"></i>Location
                  </label>
                  <input
                    type="text"
                    class="form-control"
                    id="location"
                    name="location"
                    value="{{ profile.location if profile else '' }}"
                    placeholder="City, Country"
                  />
                </div>
              </div>

              <div class="col-md-6">
                <div class="mb-3">
                  <label for="linkedin" class="form-label">
                    <i class="fab fa-linkedin me-2"></i>LinkedIn URL
                  </label>
                  <input
                    type="url"
                    class="form-control"
                    id="linkedin"
                    name="linkedin"
                    value="{{ profile.linkedin if profile else '' }}"
                    placeholder="https://linkedin.com/in/yourprofile"
                  />
                </div>

                <div class="mb-3">
                  <label for="github" class="form-label">
                    <i class="fab fa-github me-2"></i>GitHub URL
                  </label>
                  <input
                    type="url"
                    class="form-control"
                    id="github"
                    name="github"
                    value="{{ profile.github if profile else '' }}"
                    placeholder="https://github.com/yourusername"
                  />
                </div>

                <div class="mb-3">
                  <label for="twitter" class="form-label">
                    <i class="fab fa-twitter me-2"></i>Twitter URL
                  </label>
                  <input
                    type="url"
                    class="form-control"
                    id="twitter"
                    name="twitter"
                    value="{{ profile.twitter if profile else '' }}"
                    placeholder="https://twitter.com/yourusername"
                  />
                </div>

                <div class="mb-3">
                  <label for="photo" class="form-label">
                    <i class="fas fa-camera me-2"></i>Profile Photo
                  </label>
                  <input
                    type="file"
                    class="form-control"
                    id="photo"
                    name="photo"
                    accept="image/*"
                    onchange="previewImage(this)"
                  />
                  <div class="form-text">
                    <i class="fas fa-info-circle me-1"></i>
                    Recommended size: 400x400 pixels. Supported formats: JPG,
                    PNG, GIF
                  </div>
                </div>

                <!-- Image Cropper Modal -->
                <div
                  class="modal fade"
                  id="cropperModal"
                  tabindex="-1"
                  aria-labelledby="cropperModalLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="cropperModalLabel">
                          Crop Image
                        </h5>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">
                        <div class="img-container">
                          <img
                            id="cropperImage"
                            src=""
                            alt="Image to crop"
                            style="max-width: 100%"
                          />
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Cancel
                        </button>
                        <button
                          type="button"
                          class="btn btn-primary"
                          onclick="cropImage()"
                        >
                          Crop & Save
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                {% if profile and profile.photo %}
                <div class="mb-3">
                  <label class="form-label">Current Photo</label>
                  <div>
                    <img
                      src="{{ url_for('static', filename='uploads/' + profile.photo) }}"
                      alt="Current Profile Photo"
                      class="img-thumbnail"
                      style="max-width: 150px"
                    />
                  </div>
                </div>
                {% endif %}
              </div>
            </div>

            <div class="mb-3">
              <label for="about" class="form-label">
                <i class="fas fa-align-left me-2"></i>About Me
              </label>
              <textarea
                class="form-control"
                id="about"
                name="about"
                rows="5"
                placeholder="Write a brief description about yourself, your skills, and what you do..."
              >
{{ profile.about if profile else '' }}</textarea
              >
              <div class="form-text">
                <i class="fas fa-info-circle me-1"></i>
                This will be displayed on your portfolio homepage
              </div>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <a
                href="{{ url_for('admin_dashboard') }}"
                class="btn btn-outline-secondary me-md-2"
              >
                <i class="fas fa-times me-2"></i>Cancel
              </a>
              <button type="submit" class="btn btn-custom">
                <i class="fas fa-save me-2"></i>Save Profile
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
